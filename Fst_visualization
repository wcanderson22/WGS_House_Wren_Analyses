#this is the code that I used to generate Fst files and then map them onto a manhattan plot. The Fst files were generated in VCFtools, where
#I used a 25k window and a 25k step in vcftools to estimate Fst. The output file is what I read into the code below. The 
#"window25kstep25k.windowed.weir.fst" is the fst file generated by VCFtools, and the Chrom_Post.txt is a file containing the names of each
#chromosome as the appear in the VCF, in order from longest to shortest, and excluding scaffolds less than 50000 bases.

#install.packages("qqman")
library("qqman")

results <- read.table("window25kstep25k.windowed.weir.fst",header = T,stringsAsFactors = F)


#Going to re-order the scaffolds to be from largest to smallest
chr_order<-read.table("Chrom_Post.txt",header = F, stringsAsFactors = F)
chr_order

#Order them for output according to scaffold size using an index number

#First going to filter scaffs under 50kb
chr_order<-chr_order[chr_order$V3>50000,]
#Then match order to results file
index_matches<-match(results$CHROM,chr_order$V1)
results<-cbind(index_matches,results)
head(results)
#If filtering by the scaff file, remove any rows with NA in index matches column
results<-results[!(is.na(results$index_matches)),]

head(results)
#Add snp column to windowed files
snps<-c()
for (i in 1:length(results[,1])){
  snps[i]<-i
}
results<-cbind(results,snps)

head(results)

results$CHR <- as.numeric(results$CHR)

class(results$CHR)

write.table(results$CHR, file = "CHR.txt")

#For all sites
names(results)<-c("CHR","SNP","Fst")
#For windowed sites
#names(results)<-c("SNP", "CHR","BIN_START","BIN_END","N_VARIANTS","Fst","MEAN_Fst")
#For windowed sites using a chr index
names(results)<-c("CHR","CHR_Name", "BIN_START","BIN_END","N_VARIANTS","Fst","MEAN_Fst","SNP")


results$CHR <- as.numeric(results$CHR)

class(results$CHR)

#Windowed Whole Genome
svg(filename="/Users/willanderson/Desktop/Manuscript_code/HOWR_WGS_MS/Manhattan Plots/Whole_genome_manhattan.svg",width=11,height=8)

manhattan(results, chr="CHR",bp="BIN_START", p = "Fst", logp = FALSE, ylab = "Fst", genomewideline = FALSE, suggestiveline = F, main = "E vs W howr", sub = "25k window 25k step")

dev.off()

#Windowed Z Chromosome. The abline commands delimit the inversion estimates that breakdancer made.

svg(filename="/Users/willanderson/Desktop/Manuscript_code/HOWR_WGS_MS/Manhattan Plots/Z_chrom_manhattan.svg",width=11,height=8)

manhattan(subset(results, CHR==24), bp="BIN_START", p="MEAN_Fst", logp = FALSE, ylab = "Fst", genomewideline = F, suggestiveline = F, main = "E vs W howr Z CHR ", sub = "25k window 25k step")
  
  abline(v=25931123)
  abline(v=52638891) 
  abline(v=57936886) 
  abline(v=70882637)

  dev.off()
  


